<!DOCTYPE html>
<html>
<head>
  <title>Binaural Beat Generator</title>
  <style>
    /* ... (CSS styles remain the same) ... */
  </style>
</head>
<body>
  <h1>Binaural Beat Generator</h1>
  <div class="info">
    <h3>Choose the correct frequencies for different binaural beat patterns:</h3>
    <ul>
      <!-- ... (Binaural beat pattern information remains the same) ... -->
    </ul>
  </div>
  <label for="baseFrequency">Base Frequency (Hz):</label>
  <input type="number" id="baseFrequency" value="110" min="20" max="1000" step="1">
  <br><br>
  <label for="startBeatFrequency">Start Beat Frequency (Hz):</label>
  <input type="number" id="startBeatFrequency" value="0.5" min="0.5" max="50" step="0.1">
  <br><br>
  <label for="endBeatFrequency">End Beat Frequency (Hz):</label>
  <input type="number" id="endBeatFrequency" value="4" min="0.5" max="50" step="0.1">
  <br><br>
  <label for="duration">Session Duration (minutes):</label>
  <input type="number" id="duration" value="10" min="1" max="60" step="1">
  <br><br>
  <button id="startButton">Start</button>
  <button id="stopButton" disabled>Stop</button>
  
  <div id="currentBeatFrequency"></div>
  
  <div id="notableBeatFrequencies">
    <h3>Notable Beat Frequencies:</h3>
    <ul id="beatFrequencyList"></ul>
  </div>

  <script>
    let audioContext;
    let oscillatorLeft;
    let oscillatorRight;
    let playing = false;

    const startButton = document.getElementById('startButton');
    const stopButton = document.getElementById('stopButton');
    const baseFrequencyInput = document.getElementById('baseFrequency');
    const startBeatFrequencyInput = document.getElementById('startBeatFrequency');
    const endBeatFrequencyInput = document.getElementById('endBeatFrequency');
    const durationInput = document.getElementById('duration');
    const currentBeatFrequencyDisplay = document.getElementById('currentBeatFrequency');
    const beatFrequencyList = document.getElementById('beatFrequencyList');

    startButton.addEventListener('click', startBinauralBeat);
    stopButton.addEventListener('click', stopBinauralBeat);
    document.addEventListener('keydown', handleKeyDown);

    // Load settings from localStorage on page load
    loadSettings();

    function startBinauralBeat() {
      if (!playing) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();

        const baseFrequency = parseFloat(baseFrequencyInput.value);
        const startBeatFrequency = parseFloat(startBeatFrequencyInput.value);
        const endBeatFrequency = parseFloat(endBeatFrequencyInput.value);
        const duration = parseFloat(durationInput.value) * 60; // Convert minutes to seconds

        oscillatorLeft = audioContext.createOscillator();
        oscillatorRight = audioContext.createOscillator();

        oscillatorLeft.type = 'sine';
        oscillatorRight.type = 'sine';

        oscillatorLeft.frequency.value = baseFrequency;
        oscillatorRight.frequency.value = baseFrequency + startBeatFrequency;

        oscillatorLeft.connect(audioContext.destination);
        oscillatorRight.connect(audioContext.destination);

        oscillatorLeft.start();
        oscillatorRight.start();

        // Set up the frequency sweep
        const beatFrequencyDifference = endBeatFrequency - startBeatFrequency;
        const beatFrequencyStep = beatFrequencyDifference / (duration * 100); // 100 steps per second
        let currentBeatFrequency = startBeatFrequency;

        const sweepInterval = setInterval(() => {
          currentBeatFrequency += beatFrequencyStep;
          oscillatorRight.frequency.value = baseFrequency + currentBeatFrequency;
          currentBeatFrequencyDisplay.textContent = `Current Beat Frequency: ${currentBeatFrequency.toFixed(2)} Hz`;

          if (currentBeatFrequency >= endBeatFrequency) {
            clearInterval(sweepInterval);
            stopBinauralBeat();
          }
        }, 10); // 10 ms interval for smoother sweep

        playing = true;
        startButton.disabled = true;
        stopButton.disabled = false;

        // Save settings to localStorage
        saveSettings();
      }
    }

    function stopBinauralBeat() {
      if (playing) {
        oscillatorLeft.stop();
        oscillatorRight.stop();
        audioContext.close();
        playing = false;
        startButton.disabled = false;
        stopButton.disabled = true;
        currentBeatFrequencyDisplay.textContent = '';
      }
    }

    function handleKeyDown(event) {
      if (event.code === 'Space' && playing) {
        const currentBeatFrequency = oscillatorRight.frequency.value - oscillatorLeft.frequency.value;
        const listItem = document.createElement('li');
        listItem.textContent = `${currentBeatFrequency.toFixed(2)} Hz`;
        beatFrequencyList.appendChild(listItem);
      }
    }

    function saveSettings() {
      const settings = {
        baseFrequency: baseFrequencyInput.value,
        startBeatFrequency: startBeatFrequencyInput.value,
        endBeatFrequency: endBeatFrequencyInput.value,
        duration: durationInput.value
      };
      localStorage.setItem('binauralBeatSettings', JSON.stringify(settings));
    }

    function loadSettings() {
      const savedSettings = localStorage.getItem('binauralBeatSettings');
      if (savedSettings) {
        const settings = JSON.parse(savedSettings);
        baseFrequencyInput.value = settings.baseFrequency;
        startBeatFrequencyInput.value = settings.startBeatFrequency;
        endBeatFrequencyInput.value = settings.endBeatFrequency;
        durationInput.value = settings.duration;
      }
    }
  </script>
</body>
</html>